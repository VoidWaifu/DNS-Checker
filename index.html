<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNS Checker</title>
    <link rel="icon" type="image/png" href="../icon.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #e6e6e6;
            padding: 15px;
        }

        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(30, 30, 46, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
            padding-top: 40px;
        }

        .site-button {
            position: absolute;
            top: 0;
            right: 0;
            padding: 8px 16px;
            background: linear-gradient(45deg, #1976d2, #64b5f6);
            border: none;
            border-radius: 6px;
            color: white;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .site-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(25, 118, 210, 0.3);
        }

        .header h1 {
            font-size: 1.8em;
            background: linear-gradient(45deg, #64b5f6, #90caf9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }

        .header p {
            color: #b0b0b0;
            font-size: 0.95em;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 25px;
        }

        .domain-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .domain-input:focus {
            outline: none;
            border-color: #64b5f6;
            background: rgba(255, 255, 255, 0.15);
        }

        .domain-input::placeholder {
            color: #888;
        }

        .check-button {
            padding: 14px 20px;
            background: linear-gradient(45deg, #1976d2, #64b5f6);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .geo-button {
            padding: 14px 20px;
            background: linear-gradient(45deg, #1976d2, #64b5f6);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .check-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(25, 118, 210, 0.3);
        }

        .geo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(56, 142, 60, 0.3);
        }

        .check-button:disabled, .geo-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .buttons-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        .buttons-row {
            display: flex;
            gap: 12px;
            width: 100%;
        }

        .progress-container {
            margin-bottom: 25px;
            display: none;
        }

        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #64b5f6, #90caf9);
            border-radius: 3px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 8px;
            color: #b0b0b0;
            font-size: 13px;
        }

        .results {
            display: none;
        }

        .results h2 {
            color: #64b5f6;
            margin-bottom: 16px;
            font-size: 1.3em;
        }

        .record-section {
            margin-bottom: 20px;
        }

        .record-type {
            color: #90caf9;
            font-weight: 600;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.95em;
        }

        .record-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 6px;
            border-left: 3px solid #64b5f6;
            word-break: break-all;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .geo-info {
            color: #4caf50;
            font-weight: 600;
            margin-left: 8px;
            font-size: 0.85em;
        }

        .error {
            color: #f44336;
            text-align: center;
            padding: 16px;
            background: rgba(244, 67, 54, 0.1);
            border-radius: 10px;
            border-left: 3px solid #bd443b;
            display: none;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .loading-dots {
            display: inline-block;
        }

        .loading-dots::after {
            content: '';
            animation: dots 1.5s steps(4, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: ''; }
            40% { content: '.'; }
            60% { content: '..'; }
            80%, 100% { content: '...'; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }

        .language-switcher {
            position: absolute;
            top: 0;
            left: 0;
        }

        .lang-button {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .lang-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .notes-container {
            margin-bottom: 20px;
        }

        .note {
            text-align: center;
            color: #888;
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        @media (min-width: 480px) {
            .container {
                padding: 30px 25px;
            }
            
            .input-section {
                flex-direction: row;
            }
            
            .buttons-container {
                width: auto;
                min-width: 300px;
            }

            .buttons-row {
                flex-direction: row;
            }
        }

        @media (min-width: 768px) {
            .container {
                padding: 40px;
            }
            
            .header h1 {
                font-size: 2.5em;
            }
            
            .header p {
                font-size: 1.1em;
            }
            
            .input-section {
                flex-direction: row;
                gap: 15px;
            }
            
            .buttons-container {
                width: auto;
                min-width: 320px;
            }

            .buttons-row {
                flex-direction: row;
            }

            .check-button, .geo-button {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="language-switcher">
                <button class="lang-button" id="langButton">EN</button>
            </div>
            <a href="https://voidwaifu.github.io/VoidWaifu/" target="_blank" class="site-button">Мой сайт</a>
            <h1 id="title">DNS Checker</h1>
            <p id="subtitle">Проверьте все DNS записи любого домена</p>
        </div>

        <div class="notes-container">
            <div class="note" id="noteText">(Поиск DNS-записей обеспечивается Google.)</div>
            <div class="note" id="geoNoteText">(Определение геолокации обеспечивается IP-API.com.)</div>
        </div>

        <div class="input-section">
            <input type="text" class="domain-input" id="domainInput" placeholder="Введите домен или ссылку)">
            <div class="buttons-container">
                <div class="buttons-row">
                    <button class="check-button" id="checkButton">Проверить DNS</button>
                    <button class="geo-button" id="geoButton">Определить геолокацию</button>
                </div>
            </div>
        </div>

        <div class="progress-container" id="progressContainer">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Проверка DNS записей<span class="loading-dots"></span></div>
        </div>

        <div class="error" id="errorMessage"></div>

        <div class="results" id="results">
            <h2 id="resultsTitle">Результаты проверки DNS</h2>
            <div id="recordsContainer"></div>
        </div>
    </div>

    <script>
        const dnsRecordTypes = [
            'A', 'AAAA', 'MX', 'TXT', 'CNAME', 'NS', 'SOA', 'SRV', 
            'CAA', 'DS', 'DNSKEY', 'NAPTR', 'PTR', 'SPF'
        ];

        const translations = {
            ru: {
                title: "DNS Checker",
                subtitle: "Проверьте все DNS записи любого домена",
                placeholder: "Введите домен или ссылку",
                checkButton: "Проверить DNS",
                geoButton: "Определить геолокацию",
                progressText: "Проверка DNS записей",
                geoProgressText: "Определение геолокации",
                resultsTitle: "Результаты проверки DNS",
                noRecords: "Не удалось найти DNS записи для указанного домена",
                enterDomain: "Пожалуйста, введите домен или ссылку для проверки",
                checkDNSFirst: "Сначала проверьте DNS записи",
                noIPsFound: "Не найдено IP адресов для определения геолокации",
                siteButton: "Мой сайт",
                records: "записи",
                note: "(Поиск DNS-записей обеспечивается Google.)",
                geoNote: "(Определение геолокации обеспечивается IP-API.com.)"
            },
            en: {
                title: "DNS Checker",
                subtitle: "Check all DNS records of any domain",
                placeholder: "Enter domain or URL",
                checkButton: "Check DNS",
                geoButton: "Detect Geolocation",
                progressText: "Checking DNS records",
                geoProgressText: "Detecting geolocation",
                resultsTitle: "DNS Check Results",
                noRecords: "No DNS records found for the specified domain",
                enterDomain: "Please enter a domain or url to check",
                checkDNSFirst: "Check DNS records first",
                noIPsFound: "No IP addresses found for geolocation detection",
                siteButton: "My Site",
                records: "records",
                note: "(DNS lookup is powered by Google.)",
                geoNote: "(Geolocation detection is powered by IP-API.com.)"
            }
        };

        let currentLang = 'ru';

        const domainInput = document.getElementById('domainInput');
        const checkButton = document.getElementById('checkButton');
        const geoButton = document.getElementById('geoButton');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const results = document.getElementById('results');
        const recordsContainer = document.getElementById('recordsContainer');
        const errorMessage = document.getElementById('errorMessage');
        const title = document.getElementById('title');
        const subtitle = document.getElementById('subtitle');
        const resultsTitle = document.getElementById('resultsTitle');
        const langButton = document.getElementById('langButton');
        const siteButton = document.querySelector('.site-button');
        const noteText = document.getElementById('noteText');
        const geoNoteText = document.getElementById('geoNoteText');

        function extractDomain(input) {
            let domain = input.trim();
            
            if (domain.includes('://')) {
                try {
                    const url = new URL(domain);
                    domain = url.hostname;
                } catch (e) {
                    return domain.replace(/^(https?:\/\/)?(www\.)?/, '');
                }
            }
            
            domain = domain.replace(/^(https?:\/\/)?(www\.)?/, '');
            domain = domain.split('/')[0];
            domain = domain.split('?')[0];
            domain = domain.split(':')[0];
            
            return domain;
        }

        function updateLanguage() {
            const t = translations[currentLang];
            title.textContent = t.title;
            subtitle.textContent = t.subtitle;
            domainInput.placeholder = t.placeholder;
            checkButton.textContent = t.checkButton;
            geoButton.textContent = t.geoButton;
            resultsTitle.textContent = t.resultsTitle;
            siteButton.textContent = t.siteButton;
            noteText.textContent = t.note;
            geoNoteText.textContent = t.geoNote;
            langButton.textContent = currentLang === 'ru' ? 'EN' : 'RU';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            results.style.display = 'none';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        function updateProgress(current, total, isGeo = false) {
            const percentage = (current / total) * 100;
            progressFill.style.width = `${percentage}%`;
            const t = translations[currentLang];
            const text = isGeo ? t.geoProgressText : t.progressText;
            progressText.innerHTML = `${text} (${current}/${total})<span class="loading-dots"></span>`;
        }

        function createRecordSection(type, records) {
            if (!records || records.length === 0) return '';

            const section = document.createElement('div');
            section.className = 'record-section fade-in';
            
            const t = translations[currentLang];
            const typeHeader = document.createElement('div');
            typeHeader.className = 'record-type';
            typeHeader.textContent = `${type} ${t.records} (${records.length})`;
            
            section.appendChild(typeHeader);
            
            records.forEach(record => {
                const recordItem = document.createElement('div');
                recordItem.className = 'record-item';
                
                if (type === 'MX') {
                    recordItem.textContent = `Priority: ${record.priority}, Address: ${record.exchange}`;
                } else if (type === 'SOA') {
                    recordItem.textContent = `MNAME: ${record.mname}, RNAME: ${record.rname}, Serial: ${record.serial}, Refresh: ${record.refresh}, Retry: ${record.retry}, Expire: ${record.expire}, Minimum: ${record.minimum}`;
                } else if (type === 'SRV') {
                    recordItem.textContent = `Priority: ${record.priority}, Weight: ${record.weight}, Port: ${record.port}, Target: ${record.target}`;
                } else {
                    recordItem.textContent = record.data || record;
                    
                    if ((type === 'A' || type === 'AAAA') && (record.data || record)) {
                        recordItem.setAttribute('data-ip', record.data || record);
                    }
                }
                
                section.appendChild(recordItem);
            });
            
            return section;
        }

        async function checkDNSRecord(domain, type) {
            try {
                const response = await fetch(`https://dns.google/resolve?name=${encodeURIComponent(domain)}&type=${type}`);
                const data = await response.json();
                
                if (data.Answer && data.Answer.length > 0) {
                    return data.Answer.map(answer => {
                        const parts = answer.data.split('\t');
                        if (type === 'MX') {
                            const mxParts = answer.data.split(' ');
                            return {
                                priority: parseInt(mxParts[0]),
                                exchange: mxParts[1]
                            };
                        } else if (type === 'SOA') {
                            const soaParts = answer.data.split(' ');
                            return {
                                mname: soaParts[0],
                                rname: soaParts[1],
                                serial: soaParts[2],
                                refresh: soaParts[3],
                                retry: soaParts[4],
                                expire: soaParts[5],
                                minimum: soaParts[6]
                            };
                        } else if (type === 'SRV') {
                            const srvParts = answer.data.split(' ');
                            return {
                                priority: parseInt(srvParts[0]),
                                weight: parseInt(srvParts[1]),
                                port: parseInt(srvParts[2]),
                                target: srvParts[3]
                            };
                        }
                        return answer.data;
                    });
                }
                return [];
            } catch (error) {
                console.error(`Error fetching ${type} record:`, error);
                return [];
            }
        }

        async function checkAllDNSRecords() {
            const input = domainInput.value.trim();
            const t = translations[currentLang];
            
            if (!input) {
                showError(t.enterDomain);
                return;
            }

            const domain = extractDomain(input);
            
            if (!domain) {
                showError(t.enterDomain);
                return;
            }

            hideError();
            progressContainer.style.display = 'block';
            results.style.display = 'none';
            checkButton.disabled = true;
            geoButton.disabled = true;
            recordsContainer.innerHTML = '';

            const allRecords = {};
            let completed = 0;

            for (const type of dnsRecordTypes) {
                const records = await checkDNSRecord(domain, type);
                if (records.length > 0) {
                    allRecords[type] = records;
                }
                completed++;
                updateProgress(completed, dnsRecordTypes.length);
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }

            progressContainer.style.display = 'none';
            checkButton.disabled = false;
            geoButton.disabled = false;
            results.style.display = 'block';

            if (Object.keys(allRecords).length === 0) {
                showError(t.noRecords);
                return;
            }

            for (const [type, records] of Object.entries(allRecords)) {
                const section = createRecordSection(type, records);
                if (section) {
                    recordsContainer.appendChild(section);
                }
            }
        }

        async function detectGeolocation() {
            const t = translations[currentLang];
            
            const ipElements = document.querySelectorAll('[data-ip]');
            
            if (ipElements.length === 0) {
                showError(t.checkDNSFirst);
                return;
            }

            hideError();
            progressContainer.style.display = 'block';
            geoButton.disabled = true;
            
            const ips = Array.from(ipElements).map(el => el.getAttribute('data-ip'));
            let completed = 0;

            for (const ipElement of ipElements) {
                const ip = ipElement.getAttribute('data-ip');
                
                try {
                    const response = await fetch(`http://ip-api.com/json/${ip}?fields=status,message,country,city`);
                    const data = await response.json();
                    
                    if (data.status === 'success') {
                        const geoInfo = document.createElement('span');
                        geoInfo.className = 'geo-info';
                        geoInfo.textContent = `${data.country}, ${data.city}`;
                        ipElement.appendChild(geoInfo);
                    }
                } catch (error) {
                    console.error(`Error fetching geolocation for ${ip}:`, error);
                }
                
                completed++;
                updateProgress(completed, ipElements.length, true);
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            progressContainer.style.display = 'none';
            geoButton.disabled = false;
        }

        checkButton.addEventListener('click', checkAllDNSRecords);

        geoButton.addEventListener('click', detectGeolocation);

        domainInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                checkAllDNSRecords();
            }
        });

        domainInput.addEventListener('input', hideError);

        langButton.addEventListener('click', () => {
            currentLang = currentLang === 'ru' ? 'en' : 'ru';
            updateLanguage();
        });

        updateLanguage();
    </script>
</body>
</html>
